# P1 Framework

Single-file PHP 8.4+ micro-framework. Zero dependencies, copy-paste deployment.

## Architektura

- **Jeden plik:** `src/P1.php` — cały framework (~1200 LOC)
- **Namespace:** `P1` (klasy) + globalne helpery w `namespace {}`
- **Brak mail:** do maili używamy PHPMailer (zewnętrznie)

## Styl kodu

- **1TBS** (One True Brace Style) — klamra otwierająca w tej samej linii
- `declare(strict_types=1)` wszędzie
- PSR-12 z wyjątkiem 1TBS dla klas/metod
- Typy wszędzie, `===` zamiast `==`

## Klasy (P1 namespace)

HttpException, Request, Response, App, Db, View, Session, Csrf, Flash, Controller, Log, Validator, Cache, Base (fasada)

## Fasada Base

`P1\Base` — statyczne shortcuty do app/db/config. Projekty definiują własną klasę `P1 extends \P1\Base` z project-specific stałymi i helperami.

## Globalne helpery

`h()`, `ha()`, `getS()`, `strlenS()`, `substrS()`, `trimS()`, `strtotimeS()`, `strip_tagsS()`, `countS()`, `explodeS()`

Konwencja: `nazwaS()` = null-safe wrapper na oryginalną funkcję PHP.

## Testy

```bash
vendor/bin/phpunit              # wszystkie
vendor/bin/phpunit tests/Unit   # tylko unit
```

## DB

- `db/sessions.sql` — schemat sesji (MySQL)
- Session handler wspiera SQLite (INSERT OR REPLACE) i MySQL (ON DUPLICATE KEY)
- Logowanie zapytań SQL jest opcjonalne: ustaw `db.log_queries` w configu na `true`

## Bezpieczeństwo i obsługa błędów

- Globalny handler błędów zamienia ostrzeżenia na 500, a błędy fatalne są łapane przez shutdown handler
- Router zwraca `405 Method Not Allowed` z nagłówkiem `Allow`
- `App::addSecurityHeaders()` dodaje bezpieczne nagłówki (CSP, HSTS dla HTTPS, XFO, XCTO, Referrer-Policy, Permissions-Policy)
- `Request::fromGlobalsWithProxies()` i `app` config `trusted_proxies` umożliwiają bezpieczne IP za proxy
- `Session::register()` utwardza konfigurację sesji; `Session::regenerate()` służy do regeneracji ID po logowaniu

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>
